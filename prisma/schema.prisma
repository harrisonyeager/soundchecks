  generator client {
    provider = "prisma-client-js"
  }

  datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
  }

  model Profile {
    id        String   @id @default(cuid())
    clerkId   String   @unique
    username  String   @unique
    email     String
    bio       String?
    imageUrl  String?
    
    logs      ConcertLog[]
    followers Follow[]  @relation("follower")
    following Follow[]  @relation("following")
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
  }

  model ConcertLog {
    id        String   @id @default(cuid())
    profileId String
    profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
    
    // Start simple - we'll normalize later
    artist    String
    venue     String
    city      String
    date      DateTime
    rating    Float?
    notes     String?
    
    // New field for normalized relationship
    concertId String?
    concert   Concert? @relation(fields: [concertId], references: [id], onDelete: SetNull)
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@index([profileId])
    @@index([date])
    @@index([concertId])
  }

  model Follow {
    id          String   @id @default(cuid())
    followerId  String
    follower    Profile  @relation("follower", fields: [followerId], references: [id], onDelete: Cascade)
    followingId String
    following   Profile  @relation("following", fields: [followingId], references: [id], onDelete: Cascade)
    
    createdAt   DateTime @default(now())
    
    @@unique([followerId, followingId])
    @@index([followerId])
    @@index([followingId])
  }

  // New normalized models for concerts

  model Artist {
    id        String   @id @default(cuid())
    name      String
    aliases   String[]
    imageUrl  String?
    
    concerts  Concert[]
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@index([name])
  }

  model Venue {
    id        String   @id @default(cuid())
    name      String
    aliases   String[]
    city      String
    country   String
    latitude  Float?
    longitude Float?
    
    concerts  Concert[]
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@index([name])
    @@index([city])
  }

  model Concert {
    id        String   @id @default(cuid())
    artistId  String
    artist    Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)
    venueId   String
    venue     Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)
    date      DateTime
    
    concertLogs ConcertLog[]
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@unique([artistId, venueId, date])
    @@index([artistId])
    @@index([venueId])
    @@index([date])
  }